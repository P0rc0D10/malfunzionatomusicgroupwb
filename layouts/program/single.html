{{ define "main" }}
{{ $id := .File.ContentBaseName }}
<article data-page="program">
    
    <header>
        <h2>{{- .Title -}}</h2>
        <time>{{ .Date.Format "2006/01/02" }}</time>
        <div class="location">
            {{ with .Params.location }}
                {{ with .name }}
                    {{ with index $.Site.Data.locations . }}
                        {{ with .url }}
                            <a href="{{ . }}" rel="external">{{- $.Params.location.name -}}</a>
                        {{ else }}
                            <span>{{- $.Params.location.name -}}</span>
                        {{ end }}
                        {{ with .address }}
                            <span>,&nbsp;</span>
                            <address>{{- . | safeHTML -}}</address>
                        {{ end }}
                    {{ else }}
                        {{ with $.Params.location.name }}<div>{{- . | safeHTML -}}</div>{{ end }}
                        {{ with $.Params.location.address }}
                            <span>,&nbsp;</span>
                            <address>{{- . | safeHTML -}}</address>
                        {{ end }}
                    {{ end }}
                {{ else }}
                <div class="warning">MISSING LOCATION NAME</div>
                {{ end }}
            {{ else }}
            <div class="warning">MISSING LOCATION</div>
            {{ end }} 
        </div>
        {{ partial "prev_next.html" . }}
        {{ partial "tags" . }}
    </header>

     
    <!--<div class="location">
        {{ with .Params.location }}
            {{ with .link }}
            <a href="{{- . -}}">{{- $.Params.location.name | safeHTML }}</a>
            {{ else }}
            <span>{{- $.Params.location.name | safeHTML -}}</span>
            {{ end }}
            {{ with .address }}<span>, </span><address>{{- . | safeHTML -}}</adresss>{{ end }}
        {{ else }}
        <div class="warning">MISSING LOCATION</div>
        {{ end }}
    </div>-->
    
      <ul class="artists">
        {{ with .Params.artists }}
            {{ range . }}
            <li>{{- . | safeHTML -}}</li>
            {{ end }}
        {{ end }}
    </ul>

    <div class="content">{{- .Content | safeHTML -}}</div>

    <div>
        <ol class="nolist">
            {{ range .Resources.ByType "audio" }}
            <li>
                <i class="ic-audiotrack"></i>
                <a href="{{.RelPermalink}}">{{- .Name | safeHTML -}}</a>
            </li>
            {{ end }}
        </ol>
        {{ with .Params.recordings }}
        <ol class="nolist">
            {{ range . }}
            <li>
                <i class="ic-audiotrack"></i>
                <a href="{{.}}">{{- . | safeHTML -}}</a>
            </li>
            {{ end }}
        </ol>
        {{ end }}
    </div>

    {{ partial "gallery" . }}

    {{ with .Params.youtube }}
        {{ range . }}
            {{ partial "youtube" . }}
        {{ end }}
    {{ end }}

    <footer>
        {{ with .Params.photos }}
            <div class="photographer"><span>Â© Photos by </span><span>{{- . | safeHTML -}}</span></div>
        {{ end }}
        {{ with .GitInfo }}
        <div>
            <span>MOD</span>
            <a href="{{ $.Site.Params.repository }}/commit/{{ .Hash }}">
                <time>{{ .AuthorDate.Format "2006/01/02"  }}</time>
            </a>
        </div>
        {{ end }}
    </footer>


</article>
{{ end }}

{{ define "schema" }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Event",
  "location": {
    "@type": "Place",
    {{ with .Params.location.name }}"name": "{{- . -}}",{{ end }}
    {{ with .Params.location.address }}
    "address": {
        "@type": "PostalAddress",
        "streetAddress": "{{- . -}}"
    },
    {{ end }}
  },
  "name": "{{- .Title -}}",
  "startDate": "{{ .Date.Format "2006-01-02" }}"
}
</script>
{{ end }}
