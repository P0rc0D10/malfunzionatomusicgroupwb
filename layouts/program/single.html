{{ define "main" }}
{{ $id := .File.ContentBaseName }}
<article class="program">
    
    <header>
        <h2 class="title">{{- .Title -}}</h2>
        <time>{{ .Date.Format "2006/01/02" }}</time>
        <span class="location">
            {{ with .Params.location }}
                {{ with .name }}
                    {{ with index $.Site.Data.locations . }}
                        {{ with .url }}
                        <a href="{{ . }}" rel="external"><i class="ic-location_on"></i><span>{{- $.Params.location.name -}}</span></a>
                        {{ else }}
                        <span>{{- $.Params.location.name -}}</span>
                        {{ end }}
                        {{ with .address }}
                        <address>{{- . | safeHTML -}}</address>
                        {{ end }}
                    {{ else }}
                        {{ with $.Params.location.name }}<i class="ic-location_on"></i><span>{{- . | safeHTML -}}</span>{{ end }}
                        {{ with $.Params.location.address }}
                        <span>,&nbsp;</span>
                        <address>{{- . | safeHTML -}}</address>
                        {{ end }}
                    {{ end }}
                {{ else }}
                <div class="warning">MISSING LOCATION NAME</div>
                {{ end }}
            {{ else }}
            <div class="warning">MISSING LOCATION</div>
            {{ end }} 
        </span>
    </header>

      <ul class="artists">
        {{ with .Params.artists }}
            {{ range . }}
            <li>{{- . | safeHTML -}}</li>
            {{ end }}
        {{ end }}
    </ul>
    
    {{ with .Content }}
    <div class="content">{{- . | safeHTML -}}</div>
    {{ end }}

    <div class="audiofiles">
        <ol class="nolist">
            {{ range .Resources.ByType "audio" }}
            <li>
                <i class="ic-audiotrack"></i>
                <a href="{{.RelPermalink}}">{{- .Name | safeHTML -}}</a>
            </li>
            {{ end }}
        </ol>
        {{ with .Params.recordings }}
        <ol class="nolist">
            {{ range . }}
            <li>
                <i class="ic-audiotrack"></i>
                <a href="{{.}}">{{- . | safeHTML -}}</a>
            </li>
            {{ end }}
        </ol>
        {{ end }}
    </div>

    <!--{{ partial "gallery2" . }}-->
    {{ partial "gallery" . }}
    
    {{ with .Params.photos }}
    <div class="photographer"><span>Â© Photos by </span><span>{{- . | safeHTML -}}</span></div>
    {{ end }}
    
    <!--
    {{ with .Params.youtube }}
        {{ range . }}
            {{ partial "youtube" . }}
        {{ end }}
    {{ end }}
    -->
    
        <!--{{ with .GitInfo }}
        <div>
            <span>MOD</span>
            <a href="{{ $.Site.Params.repository }}/commit/{{ .Hash }}">
                <time>{{ .AuthorDate.Format "2006/01/02"  }}</time>
            </a>
        </div>
        {{ end }}-->
    
    <div class="page-nav">
        {{ partial "nav_top_prev_next.html" . }}
        {{ partial "tags" . }}
    </div>

</article>
{{ end }}

{{ define "schema" }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Event",
  "location": {
    "@type": "Place",
    {{ with .Params.location.name }}"name": "{{- . -}}",{{ end }}
    {{ with .Params.location.address }}
    "address": {
        "@type": "PostalAddress",
        "streetAddress": "{{- . -}}"
    },
    {{ end }}
  },
  "name": "{{- .Title -}}",
  "startDate": "{{ .Date.Format "2006-01-02" }}"
}
</script>
{{ end }}
