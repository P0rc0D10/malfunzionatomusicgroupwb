{{ define "main" }}
{{ $id := .File.ContentBaseName }}
<article>
    
    <header>
        <h2>{{- .Title -}}</h2>
        <nav>
            <time>{{ .Date.Format "2006/01/02" }}</time>
            {{ partial "prev_next.html" . }}
            {{ partial "tags" . }}
        </nav>
    </header>
     
    <!--<div class="location">
        {{ with .Params.location }}
            {{ with .link }}
            <a href="{{- . -}}">{{- $.Params.location.name | safeHTML }}</a>
            {{ else }}
            <span>{{- $.Params.location.name | safeHTML -}}</span>
            {{ end }}
            {{ with .address }}<span>, </span><address>{{- . | safeHTML -}}</adresss>{{ end }}
        {{ else }}
        <div class="warning">MISSING LOCATION</div>
        {{ end }}
    </div>-->

    <div class="location">
        <h2>location</h2>
        {{ with .Params.location }}
            <div>{{ .name }}</div>
        {{ end }} 
            <div>{{ .Site.Data.locations }}</div>
            {{ range where .Site.Data "locations" $.Params.location.name }}
            <div>:::::::::::::::::::::::::::{{ . }}</div>
            {{ end }}
    </div>

    <div class="content">{{- .Content | safeHTML -}}</div>

    <ul class="artists">
        {{ range .Params.artists }}
        <li>
            {{ $data := index $.Site.Data.artists . }}
            {{ with $data }}
                {{ with .url }}
                <a href="{{ . }}">{{ $data.name }}</a>
                {{ else }}
                <span>{{ $data.name }}</span>
                {{ end }}
            {{ else }}
            <span>{{ . | markdownify | safeHTML }}</span>
            {{ end }}
        </li>
        {{ end }}
    </ul>

    <div>
        <ol class="nolist">
            {{ range .Resources.ByType "audio" }}
            <li>
                <i class="ic-audiotrack"></i>
                <a href="{{.RelPermalink}}">{{- .Name | safeHTML -}}</a>
            </li>
            {{ end }}
        </ol>
        <ol class="nolist">
            {{ range .Params.recordings }}
            <li>
                <i class="ic-audiotrack"></i>
                <a href="{{.}}">{{- . | safeHTML -}}</a>
            </li>
            {{ end }}
        </ol>
    </div>
    
    {{ partial "gallery" . }}

    <footer>
        {{ with .Params.photographer }}
        <div class="photographer"><span>Â© Photos by </span><span>{{- . | safeHTML -}}</span></div>
        {{ end }}
        {{ with .GitInfo }}
        <div>
            <span>LASTMOD</span>
                <a href="{{ $.Site.Params.repository }}/commit/{{ .Hash }}">
                <span>{{ .AuthorDate.Format "2006-01-02"  }}</span>
            </a>
        </div>
        {{ end }}
    </footer>

</article>
{{ end }}

{{ define "schema" }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Event",
  "location": {
    "@type": "Place",
    {{ with .Params.location.name }}"name": "{{- . -}}",{{ end }}
    {{ with .Params.location.address }}
    "address": {
        "@type": "PostalAddress",
        "streetAddress": "{{- . -}}"
    },
    {{ end }}
  },
  "name": "{{- .Title -}}",
  "startDate": "{{ .Date.Format "2006-01-02" }}"
}
</script>
{{ end }}
