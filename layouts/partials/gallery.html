<div id="gallery">
	<link href="{{ (resources.Get "photoswipe/photoswipe.css" | resources.Minify).RelPermalink }}" rel="stylesheet">

	<script type="module">
		import PhotoSwipeLightbox from '{{ (resources.Get "photoswipe/photoswipe-lightbox.esm.js" | resources.Minify).RelPermalink }}';
		const lightbox = new PhotoSwipeLightbox({
			gallery: '#pswp--gallery',
			children: 'a',
			pswpModule: () => import('{{ (resources.Get "photoswipe/photoswipe.esm.js" | resources.Minify).RelPermalink }}')
		});
		lightbox.init();
	</script>

	{{ $images := (.Resources.ByType "image") }}
	{{ $images := where $images "Name" "!=" "cover.jpg" }}
	{{ $images := where $images "Name" "!=" "cover.png" }}

	{{ $images_landscape := slice }}
	{{ $images_portrait := slice }}
	{{ range $img := $images }}
	{{ if ge $img.Width $img.Height }}
	{{ $images_landscape = $images_landscape | append $img }}
	{{ else }}
	{{ $images_portrait = $images_portrait | append $img }}
	{{ end }}
	{{ end }}

	<ul id="pswp--gallery" class="pswp--custom-icon-colors">
		{{ range $img := $images_landscape }}
		{{/* {{ partial "gallery/item" .}} */}}
		{{ partial "gallery-item.html" .}}
		{{ end }}
		{{ range $img := $images_portrait }}
		{{/* {{ partial "gallery/item" .}} */}}
		{{ partial "gallery-item.html" .}}
		{{ end }}
	</ul>

	{{ with .Params.photos }}
	<div class="photographer">
		<i class="ic-copyright"></i>
		<span>Photos by</span>
		<span>{{- . -}}</span>
	</div>
	{{ end }}
</div>

{{ define "partials/gallery-item.html" }}
	{{ $img := . }}
	{{ $src := $img.RelPermalink }}
	{{ if ge $img.Width 1920 }}
	{{ $src = ($img.Resize "1920x").RelPermalink }}
	{{ end }}
	{{ $thumb := $img.Resize "400x" }}
	<li>
		<a href="{{ $src }}" target="_blank" data-pswp-width="{{ $img.Width }}" data-pswp-height="{{ $img.Height }}">
			<figure>
				<img src="{{ $thumb.RelPermalink }}">
				<figcaption class="meta">
					<div class="exif">
						{{ with $img.Exif }}
						{{ with .Tags }}
						{{ with .DateTimeOriginal }}
						{{ if hasPrefix . "0000:00:00" }}
						{{ else }}
						{{ (time .).Format "15:04" }}
						{{ end }}
						{{ end }}
						{{ end }}
						{{ end }}
					</div>
				</figcaption>
			</figure>
		</a>
	</li>
{{ end }}
