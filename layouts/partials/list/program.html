{{ $events := .Scratch.Get "events" }}
{{ $show_artists := .Scratch.Get "show_artists" | default true }}
<!-- {{ $only_upcoming := .Scratch.Get "only_upcoming" | default true }} -->

{{ if eq $events nil }}
    {{ $events = where .RegularPagesRecursive.ByDate.Reverse "Section" "program" }}
{{ end }}

<ol class="data-list program" reversed>
    {{ range $events }}
    <!-- {{ $upcoming := (time .Date).After now }} -->
    <!-- { { if (not $upcoming) }} -->
    <!-- <li class="event{{ if $upcoming }} upcoming{{ end }}" id="{{ .File.ContentBaseName }}"> -->
    <li class="event" id="{{ .File.ContentBaseName }}">
        <a href="{{ .RelPermalink }}" class="title">{{ .Title }}</a>
        {{ partial "meta/date" . }}
        {{ .Scratch.Set "show_address" false }}{{ partial "meta/location" . }}
        <div class="artists">{{ partial "list/artists" . }}</div>
        <!-- <canvas data-artists="{{ range .Params.artists }}{{lower .}},{{ end }}" class=""></canvas> -->
    </li>
    {{ end }}
</ol>

<script>
const now = new Date().getTime();
const list = document.querySelector("ol.program");
let li, date, lastUpcomingIndex;
for( let i = 0; i < list.children.length; i++ ) {
    li = list.children[i];
    date = new Date(li.querySelector("time").attributes.datetime.value);
    if(date.getTime() < now){
        lastUpcomingIndex= i;
        break;
    }
}
if(lastUpcomingIndex > 0) {
    list.insertBefore(document.createElement("hr"), list.children[lastUpcomingIndex]);
}
</script>

