{{ $events := .Scratch.Get "events" }}
{{ $show_artists := .Scratch.Get "show_artists" | default true }}

{{ if eq $events nil }}
    {{ $events = where .RegularPagesRecursive.ByDate.Reverse "Section" "program" }}
{{ end }}

<ol class="data-list program" reversed>
    {{ range $events }}
    <li class="event" id="{{ .File.ContentBaseName }}">
        <a href="{{ .RelPermalink }}" class="title">{{ .Title }}</a>
        {{ partial "meta/date" . }}
        {{ .Scratch.Set "show_address" false }}{{ partial "meta/location" . }}
        <div class="artists">{{ partial "list/artists" . }}</div>
        <!-- <canvas data-artists="{{ range .Params.artists }}{{lower .}},{{ end }}" class=""></canvas> -->
    </li>
    {{ end }}
</ol>

<script>
const now = new Date().getTime();
const list = document.querySelector("ol.program");
let date, lastUpcomingIndex;
for(let i = 0; i < list.children.length; i++) {
    date = new Date(list.children[i].querySelector("time").attributes.datetime.value);
    if(date.getTime() < now){
        lastUpcomingIndex= i;
        break;
    }
}
if(lastUpcomingIndex > 0) {
    list.insertBefore(document.createElement("hr"), list.children[lastUpcomingIndex]);
}
</script>

